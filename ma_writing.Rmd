---
title: "Master's in Latin American, Caribbean and Iberian Studies"
author: "Álvaro C."
date: "`r Sys.Date()`"
output:
  html_document:
    self-contained: yes
    toc: yes
    toc_float:
      collapsed: no
      smooth_scrool: no
    number_sections: yes
bibliography: references.bib
csl: apa7.csl
link-citations: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
```


```{=html}
<style>
body {
  text-align: justify;
}
</style>
```


```{r main code, message=FALSE, warning=FALSE, include=FALSE}
############## PARTE 1 #############
# 1. Peparamos ambiente de trabajo ####
library(pacman)
pacman::p_load(tidyverse,
               haven,
               magrittr,
               sjPlot,
               sjmisc,
               sjlabelled,
               stargazer,
               summarytools,
               expss,
               car,
               foreign,
               coefplot,
               fastDummies,
               knitr)

rm(list=ls())       # borrar todos los objetos en el espacio de trabajo
options(scipen=999) # valores sin notación científica


# 2. Abrimos dataset ####
setwd("C:/Users/Alvaro C/Dropbox/1. Escritos/1. Artículos/1 2023_Estallido Social, malestar material y protesta")
#setwd("C:/Users/alvar/Dropbox/1. Escritos/1. Artículos/1 2023_Estallido Social, malestar material y protesta")

db<-read_dta("C:/Users/Alvaro C/Dropbox/Statistic/Data/Datasets/ISSP/ISSP 2014 - Citizenship II - No. 6670/ISSP_2014_CITZENSHIP.dta")
#db<-read_dta("C:/Users/alvar/Dropbox/Statistic/Data/Datasets/ISSP/ISSP 2014 - Citizenship II - No. 6670/ISSP_2014_CITZENSHIP.dta")


# 3. Seleccionamos variables de interés ####

#1 Recordar: find_var(data = YYY,"XXX") para buscar variables

db<-select(db,
           SEX,
           AGE,
           DEGREE,
           EMPREL, #employee, self-emplyed or working for your own's family
           NEMPLOY, #Self-employed, how many employe
           WRKSUP, #Supervise?
           TOPBOT, #Subjective Social Class
           V17, #Political: Sign a petition
           V18, #Collective Action: Boycot certain products
           V19, #Collective: Take part in demonstration
           V20, #Collective: Attend political meeting
           V21, #Political: Contact a politician
           V22, #Political: Donate money or raise funds
           V23, #Political: Contact media
           V24, #Political: Express views on the internet
           V25, #Political: Using media to get political news
           V27, #Member: Political Party
           V28, #Trade Union
           V48, #Political Self-Placement
           ISCO08 #Occupation (ISCO 2008)
)



# 5. Eliminamos NA ####

recoding_specs <- list(
  SEX = 9,
  AGE = 999,
  DEGREE = 9,
  EMPREL = c(0, 9),
  NEMPLOY = c(9995, 9998, 9999),
  WRKSUP = c(0, 8, 9),
  TOPBOT = c(0,98, 99),
  V17 = c(8, 9),
  V18 = c(8, 9),
  V19 = c(8, 9),
  V20 = c(8, 9),
  V21 = c(8, 9),
  V22 = c(8, 9),
  V23 = c(8, 9),
  V24 = c(8, 9),
  V25 = c(8, 9),
  V27 = c(8, 9),
  V28 = c(8, 9),
  V48 = c(98, 99),
  ISCO08= c(0, 9998, 9999, 0110, 0210, 0310))

for (var in names(recoding_specs)) {
  if (!is.null(recoding_specs[[var]])) {
    recoding_values <- recoding_specs[[var]]
    db[[var]] <- recode(db[[var]], paste("c(", paste(recoding_values, collapse = ","), ")=NA"))
  }
}





############## PARTE 2 #############


# 1. Construccion de variable####

## 1.1 Construcción de variable Clase Social (Erik Wright)

#Construcción de autoempleado
db$auto_emp <- ifelse(db$EMPREL == 1, 2, 1) #f value 1 (employee) then the value is 2, if not (self-employee), the value is 1.

#Construcción de credencial ## DE MOMENTO: AQUELLOS QUE SE SALEN QUEDAN COMO NO CREDENCIALIZADOS
db$credencial <- car::recode(db$DEGREE,
                             "0:3=1; 4=2; 5:6=3")


#Construcción de variable "skills_2digit"
db$skills_2digit <- car::recode(db$ISCO08,
                                "1000=10; 1100:1120=11; 1200:1223=12; 1300:1349=13;
                                1400:1439=14; 2000=20; 2100:2166=21; 2200:2269=22;
                                2300:2359=23; 2400:2434=24; 2500:2529=25; 2600:2659=26;
                                3000=30; 3100:3155=31; 3200:3259=32; 3300:3359=33; 3400:3435=34;
                                3500:3522=35; 4000=40; 4100:4132=41; 4200:4229=42; 4300:4323=43;
                                4400:4419=44; 5000=50; 5100:5169=51; 5200:5249=52; 5300:5329=53;
                                5400:5419=54; 6000=60; 6100:6130=61; 6200:6224=62; 6300:6340=63;
                                7000=70; 7100:7133=71; 7200:7234=72; 7300:7323=73; 7400:7422=74;
                                7500:7549=75; 8000=80; 8100:8189=81; 8200:8219=82; 8300:8350=83;
                                9000=90; 9100:9129=91; 9200:9216=92; 9300:9334=93; 9400:9412=94;
                                9500:9520=95; 9600:9629=96")



#Construcción de variable Skills:
db$skills <- car::recode(db$skills_2digit,
                         recodes = "10:26=1; c(30,31,32,33,34,35,36,60,61,72)=2;
                                    c(40,41,42,43,44,50,51,52,53,54,62,63,70,71,73,74,75,76,76,77,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96)=3")



#Construcción de num_empleados
db$num_empleados <- car::recode(db$NEMPLOY,
                                "1:9=1; 10:6000=2; 0=3")


#Construcción de Clase Social
db$css <- NA

# Condition 1: Burguesía tradicional (Value: 1)
db$css[db$auto_emp == 1 & db$num_empleados == 2 & db$WRKSUP == 1] <- 1

# Condition 2: Pequeño empleador (Value: 2)
db$css[db$auto_emp == 1 & db$num_empleados == 1 & db$WRKSUP == 1] <- 2

# Condition 3: Pequeña burguesía (Value: 3)
db$css[db$auto_emp == 1 & db$num_empleados == 3] <- 3

# Condition 4: Directivo/Supervisor Experto (BA) (Value: 4) - (Skills grupo 10 al 26 (isco) + Correción por credencial)
db$css[db$auto_emp == 2 & db$WRKSUP == 1 & db$skills == 1 & db$credencial == 3 ] <- 4

# Condition 5: Experto (BA+) No directivo (Value: 5)
db$css[db$auto_emp == 2 & db$WRKSUP == 2 & db$skills == 1 & db$credencial == 3] <- 5

# Condition 6: Directivo/Supervisor Semi-Credencializado (Value: 6)
db$css[db$auto_emp == 2 & db$WRKSUP == 1 & db$skills == 2] <- 6

# Condition 7: Obrero semi-credencializado (Value: 7)
db$css[db$auto_emp == 2 & db$WRKSUP == 2 & db$skills == 2] <- 7

# Condition 8: Directivo/Supervisor no credencializado (Value: 8)
db$css[db$auto_emp == 2 & db$WRKSUP == 1 & db$skills == 3] <- 8

# Condition 9: Proletariado tradicional (Value: 9)
db$css[db$auto_emp == 2 & db$WRKSUP == 2 & db$skills == 3] <- 9


## 6.2 Construcción de variables de control
#Clase Social subjetiva
db$cs_sub <- car::recode(db$TOPBOT,
                         "1:4=1; 5:6=2; 7:10=3")


#Posición Política
db$pos_pol <- car::recode(db$V48,
                          "0:4=1; 5=2; 6:10=3")


# Construcción de variable acción colectiva (sumatoria)
#Loop that recodes, 1:2 = 1 (Yes), 3:4 = 2 (No)
variables <- c("V17", "V18", "V19", "V22")  # List of variables to recode

for (var in variables) {
  db[[var]] <- ifelse(db[[var]] %in% c(1, 2), 1, ifelse(db[[var]] %in% c(3, 4), 2, db[[var]]))
}
#Loop para reemplazar 2 por 0 y que 1 sea participar
replace_values <- function(data, vars) {
  for (var in vars) {
    data[[var]] <- ifelse(data[[var]] == 2, 0, data[[var]])
  }
  return(data)
}
variables <- variables <- c("V17", "V18", "V19", "V22") 
db <- replace_values(db, variables)


#Segundo: Sumatoria
# Create a new variable named 'new_variable' as the summation of other variables
db$acc <- rowSums(db[, c("V17", "V18", "V19", "V22")])


#Construcción de acc2
db$acc2 <- car::recode(db$acc,
                       "0=0; 1:16=1")




############## PARTE 3 #############
db$css <- set_labels(db$css,
                     labels=c( "Burguesía tradicional"=1,
                               "Pequeño empleador"=2,
                               "Pequeña Burguesía"=3,
                               "Directivo/Supervisor Experto"=4,
                               "Experto no directivo"=5,
                               "Directivo/Supervisor semi-credencializado"=6,
                               "Obrero semi-credencializado"=7,
                               "Directivo/Supervisor no credencializado"=8,
                               "Proletario tradicional"=9)) #Clase Social

db$cs_sub <- set_labels(db$cs_sub,
                        labels=c("Clase Subjetiva baja"=1, "Clase Subjetiva Media"=2,
                                 "Clase Subjetiva Alta"=3)) #Clase Social Subjetiva


db$pos_pol <- set_labels(db$pos_pol,
                         labels=c("Izquierda"=1, "Centro"=2,
                                  "Derecha"=3)) #Posición Política

#Seleccionamos otra bdd
db2<-select(db,
            SEX,
            AGE,
            acc,
            pos_pol,
            css,
            cs_sub)


############## PARTE 4 #############


#Pasamos a factor para regresión
db$css<-as_factor(db$css) #Clase Social Marx
db$sex<-as_factor(db$SEX) #Sexo
db$cs_sub2<-as_factor(db$cs_sub) #Clase Social Subj.
db$pos_pol2<-as_factor(db$pos_pol) #Posición política


```

# Writing recordatory

1.  Paragrpah main idea
2.  Examples
3.  Sum

# Introduction

Social movement studies have a long-standing tradition of studying conflict, social change, and what some scholars contentious politics [@mcadam2004].

However, with the recent protests located in the Global North have shown that

# Social Movements, Capitalism, and Class

## Social Movement classic research agenda

[@tarrow1996]

[@mcadam1999]

[@mcadam2004]

[@gamson1996]

[@benford2000]

[@snow1986]

[@goodwin2001]

[@tarrow2011]

## (Re)turning to Capitalism

[@giugni2016]

[@arce2007; @bellinger2011]

[@rossi2022]

[@stanley2013]

[@dellaporta2015a]

[@dellaporta2017c]

@dellaporta2020

## Class and Social Movements

[@eder2013]

[@eidlin2018]

[@hellinger2020]

[@therborn2012]

# Methodology

## Data

This article uses a quantitative methodology based on the [Social Survey Programme 2014 - Citizenship II (ISSP)](https://www.gesis.org/en/issp/modules/issp-modules-by-topic/citizenship/2014)[^1] (N = 49.087). This dataset applies a similar[^2] questionnaire in every country in which it is applied. The sampling procedure differs for each country: in some countries, partly simple random samples were applied, whereas in others, partly multistage stratified random samples. The data was collected in two ways. The first one was through interviews (face-to-face, Computer Assisted Personal interviews, or completed on the telephone) or Self-administered questionnaires (Computer Assisted self-interviews or Computer-Assisted web interviews). The analysis is mostly applied to individuals that are 18 years or more with some exceptions[^3]. After processing the dataset, the sample was reduced to 33.582 individuals nested in 34 countries.

[^1]: By the time this article has been written, another wave of the same thematic survey is under development and expected to fully realese in 2025.

[^2]: It is a similar questionary because the survey don't apply the exact same questions in every country. However, the questions are prepared to grasp and collect the same dimensions for every question applied.

[^3]: According to the ISSP, the exceptions were countries such as Finland, were individuals between 15 and 75 were surveyed, Japan, were 16 years old and older were surveyed, South Africa, were the respondents were 16 years or more, and Sweden, were the individuals were between 17 and 79 years old.

## Methods

The hypotheses that led this study were tested by calculating OLS. According to @huntington-klein2022 , Linear regressions are the "*best linear approximation of the relationship*" between two variables.

As the literature says [@angrist2009; @chatterjee2006; @angrist2014; @huntington-klein2022], Linear Models are appropriate when we seek [....]. In this case, since we are testing the effect that class structure has on the working class participation in collective action activities, other models that provide a better understanding of probability, such as Logistic and Logit, aren't required. To put it in other words, since we are not measuring the *probability* that the working class has to undertake collective action activities but the *influence* that class structure itself has on

# Analysis

1

## Descriptives

1

## Models

```{r regressions, message=FALSE, warning=FALSE, include=FALSE, results='asis'}
##### MODELOS ######

#Modelo 1: Variable dependiente Acción Colectiva  / #Independiente = css

# Modelo A
reg1<-lm(acc ~ css, data = db)

# Modelo A.2
reg2<-lm(acc ~ css+cs_sub2, data = db)

# Modelo A.3
reg3<-lm(acc ~ css+cs_sub2+pos_pol2, data = db)

# Modelo A.4
reg4<-lm(acc ~ css+cs_sub2+pos_pol2+AGE+sex, data = db)

```

```{r regressions2, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
#. Visualización

library(stargazer)
stargazer(
  reg1, reg2, reg3, reg4,
  type = "html",
  colnames = FALSE,
  model.numbers = FALSE,
  dep.var.caption = " ",
  dep.var.labels = "ACC",
  covariate.labels = c("Pequeño empleador",
                               "Pequeña Burguesía",
                               "Directivo/Supervisor Experto",
                               "Experto no directivo",
                               "Directivo/Supervisor semi-credencializado",
                               "Obrero semi-credencializado",
                               "Directivo/Supervisor no credencializado",
                               "Proletario tradicional",
                       "Clase Subjetiva Media", "Clase Subjetiva Baja",
                       "Centro", "Derecha", "Edad", "Sexo"),
  keep.stat = c("rsq", "f"),
  notes.align = "l"
  )

```

# Discussion

# Conclusions

# References
